import{d as x,o as S,a as W,b as y,c as M,e as ae,f as e,t as m,r as $,w as A,F as N,g as F,n as z,i as U,h as O,j as V,k as G,l as X,m as oe,v as ne,p as le,s as P,q as Z,u as ie,x as re,y as ee,z as q,A as te,B as ce,C as de,D as ue,P as Y,G as ve,S as me,W as fe,E as pe,O as ge,H as _e,I as he,V as ye,J as be,K as we,L as Me,M as J,N as E,Q as $e,R as Le,T as De,U as xe,X as Q,Y as Ce,Z as Se}from"./vendor-Cl2jD13j.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function i(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(t){if(t.ep)return;t.ep=!0;const s=i(t);fetch(t.href,s)}})();const ke={class:"layout-header"},Ee={class:"header-right"},Pe=x({__name:"LayoutHeader",setup(p){const o=$(""),i=$(""),d=$(""),t=()=>{const r=new Date,c=r.getHours().toString().padStart(2,"0"),n=r.getMinutes().toString().padStart(2,"0"),u=r.getSeconds().toString().padStart(2,"0");o.value=`${c}:${n}:${u}`;const f=r.getFullYear(),a=(r.getMonth()+1).toString().padStart(2,"0"),L=r.getDate().toString().padStart(2,"0");i.value=`${f}-${a}-${L}`;const k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];d.value=k[r.getDay()]};let s=null;return S(()=>{t(),s=window.setInterval(t,1e3)}),W(()=>{s&&(clearInterval(s),s=null)}),(r,c)=>(y(),M("div",ke,[c[0]||(c[0]=ae('<div class="header-midden" data-v-fb70a80a><div class="cn" data-v-fb70a80a>数据中心数字孪生智能运维平台</div><div class="en" data-v-fb70a80a> Data Center Digital Twin Intelligent Operation Platform </div></div><div class="header-left" data-v-fb70a80a><i class="fa-regular fa-envelope" data-v-fb70a80a></i><div class="message" content="【系统通知】感谢大家对我们项目的关注与支持!希望能为我们的项目点一个Star,您的支持对我们来说至关重要。" data-v-fb70a80a></div></div>',2)),e("div",Ee,[e("span",null,m(o.value),1),e("span",null,m(i.value),1),e("span",null,m(d.value),1)])]))}}),C=(p,o)=>{const i=p.__vccOpts||p;for(const[d,t]of o)i[d]=t;return i},Te=C(Pe,[["__scopeId","data-v-fb70a80a"]]),Ae={class:"content"},Ie={class:"device-info"},ze={class:"device-name"},We={class:"device-event"},Oe={class:"device-time"},He=x({__name:"AlarmDeviceList",props:{devices:{}},emits:["close"],setup(p,{emit:o}){const i=o,d=r=>({1:"#74fabd",2:"#5bc7fa",3:"#f1bd49"})[r],t=r=>({1:"一般",2:"中等",3:"严重"})[r],s=()=>{i("close")};return(r,c)=>(y(),M("div",{class:"alarm-device-list",onClick:c[0]||(c[0]=A(()=>{},["stop"]))},[e("div",{class:"header"},[c[1]||(c[1]=e("div",{class:"title"},"告警设备列表",-1)),e("div",{class:"close-btn",onClick:s},"×")]),e("div",Ae,[(y(!0),M(N,null,F(p.devices,n=>(y(),M("div",{class:"device-item",key:n.id},[e("div",Ie,[e("div",ze,m(n.name),1),e("div",We,m(n.event),1)]),e("div",Oe,m(n.time),1),e("div",{class:"device-type",style:z({background:d(n.type)})},m(t(n.type)),5)]))),128))])]))}}),Re=C(He,[["__scopeId","data-v-717b41c8"]]),Ne={class:"layout-footer"},Fe=x({__name:"LayoutFooter",setup(p){const o=X({isWarming:!0}),i=U("events"),d=$(!1);S(()=>{i&&i.startWarming()});const t=$([{name:"1# 服务器机柜",event:"温度过高",type:1,time:"08:21"},{name:"2# 服务器机柜",event:"内存过载",type:3,time:"12:53"},{name:"3# 服务器机柜",event:"硬盘故障",type:1,time:"16:42"},{name:"1# 网络设备",event:"网络异常",type:3,time:"08:32"},{name:"6# 网络设备",event:"丢包率过高",type:2,time:"17:43"},{name:"1# 电源柜",event:"电压波动",type:2,time:"09:44"},{name:"2# 电源柜",event:"电流过高",type:3,time:"12:53"},{name:"3# 电源柜",event:"电压波动",type:2,time:"09:44"},{name:"4# 电源柜",event:"电流过高",type:3,time:"12:53"},{name:"5# 电源柜",event:"电压波动",type:2,time:"09:44"},{name:"6# 电源柜",event:"电流过高",type:3,time:"12:53"}]),s=G(()=>t.value.map((c,n)=>({id:n,name:c.name,event:c.event,type:c.type,time:c.time}))),r=G(()=>{const c={};return c.cursor="pointer",c.color=o.isWarming?"#38bdf8":"#e2e8f0",c});return(c,n)=>(y(),M("div",Ne,[e("div",{class:"item",style:z(r.value),onClick:n[0]||(n[0]=u=>d.value=!0)}," 设备告警 ",4),d.value?(y(),O(Re,{key:0,devices:s.value,onClose:n[1]||(n[1]=u=>d.value=!1),onClick:n[2]||(n[2]=A(()=>{},["stop"]))},null,8,["devices"])):V("",!0)]))}}),Be=C(Fe,[["__scopeId","data-v-367f97c9"]]),je={class:"layout-loading"},Ue={class:"loading-tip"},Ve=x({__name:"LayoutLoading",props:{loading:{}},setup(p){return(o,i)=>oe((y(),M("div",je,[i[0]||(i[0]=e("div",{class:"loading-gif"},null,-1)),e("div",Ue," 模型正在加载中 ("+m(p.loading.loaded)+"/"+m(p.loading.total)+") ... ",1)],512)),[[ne,p.loading.isLoading]])}}),Ge=C(Ve,[["__scopeId","data-v-2f4e78eb"]]);function qe(){const p=$(null),o=P(null),i=()=>o.value?.resize(),d=()=>o.value?.clear(),t=(r="light")=>{o.value&&o.value?.dispose(),Z.isElement(p.value)?o.value=ie(p.value,r):console.warn("容器还未初始化"),window.removeEventListener("resize",i),window.addEventListener("resize",i)},s=r=>{o.value||t(),o.value?.setOption(r)};return W(()=>{window.removeEventListener("resize",i)}),S(()=>{window.addEventListener("resize",i)}),{container:p,chart:o,setOption:s,resize:i,clear:d,echarts:le}}const Ke={class:"layout-panel"},Ye={class:"panel-header"},Je={class:"panel-header-title"},Qe={class:"panel-body"},Xe=x({__name:"LayoutPanel",props:{title:{}},setup(p){return(o,i)=>(y(),M("div",Ke,[e("div",Ye,[e("div",Je,m(p.title),1)]),e("div",Qe,[re(o.$slots,"default",{},void 0)])]))}}),K=C(Xe,[["__scopeId","data-v-20bc707e"]]),Ze=x({__name:"WidgetPanel01",setup(p){const{container:o,echarts:i,setOption:d}=qe(),t=()=>{const c=[],n=new Date;for(let u=60;u>=0;u-=1){const f=new Date(n.getTime()-u*60*1e3),a=String(f.getMinutes()).padStart(2,"0");c.push(`${f.getHours()}:${a}`)}return c},s=()=>{const c=[];for(let u=60;u>=0;u-=1){const f=Math.random()*10-5,a=Math.max(0,Math.min(100,5+f+Math.sin(u/10)*5));c.push(a.toFixed(1))}return c},r=()=>({legend:{show:!1},tooltip:{trigger:"axis",backgroundColor:"#fff",borderColor:"#e0e0e0",textStyle:{color:"#333"},formatter(c){const n=c[0];return`<div style="padding: 5px 0;">
          <div style="color: #333; font-size: 14px;">${n.name}</div>
          <div style="color: #3b82f6; font-size: 16px; margin-top: 5px;">故障变化率: ${n.value}%</div>
        </div>`}},grid:{left:"4%",right:"4%",bottom:"0%",top:"20%",containLabel:!0},xAxis:{type:"category",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#666",margin:10,fontSize:12,interval:9},data:t()},yAxis:{type:"value",name:"故障变化率(%)",nameTextStyle:{color:"#666",fontSize:12},axisLabel:{color:"#666"},splitLine:{lineStyle:{color:"#e0e0e0",type:"dashed"}},min:0,max:100},series:[{name:"故障变化率",type:"line",smooth:!0,symbol:"none",lineStyle:{color:"rgba(59, 130, 246, 1)",width:2},areaStyle:{color:new i.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(59, 130, 246, 0.3)"},{offset:1,color:"rgba(59, 130, 246, 0.01)"}])},data:s()}]});return S(()=>{ee(()=>{const c=r();d(c)})}),(c,n)=>(y(),O(K,{title:"设备故障变化率"},{default:q(()=>[e("div",{class:"container",ref_key:"container",ref:o},null,512)]),_:1}))}}),et=C(Ze,[["__scopeId","data-v-80de8484"]]),tt={class:"weather-monitor"},st={class:"weather-label"},at={class:"weather-value"},ot={class:"value"},nt={class:"unit"},lt=x({__name:"WidgetPanel04",setup(p){const o=[{icon:"fa-solid fa-server",label:"服务器机柜",value:"23",unit:"个"},{icon:"fa-solid fa-network-wired",label:"网络设备",value:"23",unit:"个"},{icon:"fa-solid fa-bolt",label:"电源柜",value:"23",unit:"个"},{icon:"fa-solid fa-temperature-three-quarters",label:"温湿度传感器",value:"11",unit:"个"},{icon:"fa-solid fa-snowflake",label:"空调系统",value:"63",unit:"个"},{icon:"fa-solid fa-shield-alt",label:"防火墙",value:"23",unit:"个"},{icon:"fa-solid fa-ethernet",label:"交换机",value:"12",unit:"个"},{icon:"fa-solid fa-database",label:"存储设备",value:"12",unit:"个"},{icon:"fa-solid fa-video",label:"监控设备",value:"13",unit:"个"}];return(i,d)=>(y(),O(K,{title:"设备规模"},{default:q(()=>[e("div",tt,[(y(),M(N,null,F(o,(t,s)=>e("div",{key:s,class:"widget-weather-item"},[e("div",{class:te(["weather-icon",t.icon])},null,2),e("div",st,m(t.label),1),e("div",at,[e("span",ot,m(t.value),1),e("span",nt,m(t.unit),1)])])),64))])]),_:1}))}}),it=C(lt,[["__scopeId","data-v-43103533"]]),rt={class:"wrap"},ct={class:"item-name"},dt={class:"item-type"},ut={class:"item-time"},vt=x({__name:"WidgetPanel06",setup(p){const{disableControls:o,enableControls:i}=U("events"),d=U("mask"),t=$(!1);ce(t,u=>{u?(o(),d.show()):(i(),d.hide())});const s=$([{name:"1# 服务器机柜",event:"温度过高",type:1,time:"08:21"},{name:"2# 服务器机柜",event:"内存过载",type:3,time:"12:53"},{name:"3# 服务器机柜",event:"硬盘故障",type:1,time:"16:42"},{name:"1# 网络设备",event:"网络异常",type:3,time:"08:32"},{name:"6# 网络设备",event:"丢包率过高",type:2,time:"17:43"},{name:"1# 电源柜",event:"电压波动",type:2,time:"09:44"},{name:"2# 电源柜",event:"电流过高",type:3,time:"12:53"},{name:"3# 电源柜",event:"电压波动",type:2,time:"09:44"},{name:"4# 电源柜",event:"电流过高",type:3,time:"12:53"},{name:"5# 电源柜",event:"电压波动",type:2,time:"09:44"},{name:"6# 电源柜",event:"电流过高",type:3,time:"12:53"}]),r=$(),c=(u,f=!1)=>{const a={1:"#10b981",2:"#3b82f6",3:"#f59e0b"};return f?`linear-gradient(90deg, ${a[u]}20 , transparent )`:a[u]};let n=null;return S(()=>{n&&window.clearInterval(n),n=setInterval(()=>{r.value.classList.add("scroll"),setTimeout(()=>{if(!n)return;r.value.classList.remove("scroll");const u=s.value.shift();u&&s.value.push(u)},2e3)},3e3)}),W(()=>{n&&(window.clearInterval(n),n=null)}),(u,f)=>(y(),O(K,{title:"预警情况"},{default:q(()=>[e("div",rt,[e("div",{class:"item-list",ref_key:"container",ref:r},[(y(!0),M(N,null,F(s.value,(a,L)=>(y(),M("div",{class:"item",key:L,style:z({background:c(a.type,!0)})},[e("div",{class:"item-circle",style:z({background:c(a.type)})},null,4),e("div",ct,m(a.name),1),e("div",dt,m(a.event),1),e("div",ut,m(a.time),1)],4))),128))],512)])]),_:1}))}}),mt=C(vt,[["__scopeId","data-v-7d69249f"]]),ft={class:"header"},pt={class:"title"},gt={class:"content"},_t={class:"info-section"},ht={class:"info-item"},yt={class:"info-value"},bt={class:"info-item"},wt={class:"info-item"},Mt={class:"info-value"},$t={class:"info-item"},Lt={class:"info-value"},Dt={class:"info-section"},xt={class:"info-item"},Ct={class:"info-value"},St={class:"info-item"},kt={class:"info-value"},Et={class:"info-item"},Pt={class:"info-value"},Tt={class:"info-item"},At={class:"info-value"},It={class:"info-item"},zt={class:"info-value"},Wt={class:"info-section"},Ot={class:"info-item"},Ht={class:"info-value"},Rt={class:"info-item"},Nt={class:"info-value"},Ft={class:"info-item"},Bt={class:"info-value"},jt={class:"info-item"},Ut={class:"info-value"},Vt={class:"info-section"},Gt={class:"alarm-list"},qt={class:"alarm-info"},Kt={class:"alarm-name"},Yt={class:"alarm-time"},Jt=x({__name:"DeviceDetailPanel",props:{deviceData:{}},emits:["close"],setup(p,{emit:o}){const i=p,d=o,t=G(()=>i.deviceData),s=f=>({normal:"status-normal",warning:"status-warning",error:"status-error"})[f]||"status-normal",r=f=>({normal:"正常",warning:"警告",error:"故障"})[f]||"正常",c=f=>({warning:"#f1bd49",error:"#ff0000",info:"#5bc7fa"})[f]||"#5bc7fa",n=f=>({warning:"⚠",error:"❌",info:"ℹ"})[f]||"ℹ",u=()=>{d("close")};return(f,a)=>(y(),M("div",{class:"device-detail-panel",onClick:a[0]||(a[0]=A(()=>{},["stop"]))},[e("div",ft,[e("div",pt,m(t.value.name),1),e("div",{class:"close-btn",onClick:A(u,["stop"])},"×")]),e("div",gt,[e("div",_t,[a[5]||(a[5]=e("div",{class:"info-title"},"设备基本信息",-1)),e("div",ht,[a[1]||(a[1]=e("div",{class:"info-label"},"设备类型",-1)),e("div",yt,m(t.value.type),1)]),e("div",bt,[a[2]||(a[2]=e("div",{class:"info-label"},"设备状态",-1)),e("div",{class:te(["info-value",s(t.value.status)])},m(r(t.value.status)),3)]),e("div",wt,[a[3]||(a[3]=e("div",{class:"info-label"},"设备编号",-1)),e("div",Mt,m(t.value.serialNumber),1)]),e("div",$t,[a[4]||(a[4]=e("div",{class:"info-label"},"安装位置",-1)),e("div",Lt,m(t.value.location),1)])]),e("div",Dt,[a[11]||(a[11]=e("div",{class:"info-title"},"实时参数",-1)),e("div",xt,[a[6]||(a[6]=e("div",{class:"info-label"},"温度",-1)),e("div",Ct,m(t.value.temperature)+"°C",1)]),e("div",St,[a[7]||(a[7]=e("div",{class:"info-label"},"湿度",-1)),e("div",kt,m(t.value.humidity)+"%",1)]),e("div",Et,[a[8]||(a[8]=e("div",{class:"info-label"},"电压",-1)),e("div",Pt,m(t.value.voltage)+"V",1)]),e("div",Tt,[a[9]||(a[9]=e("div",{class:"info-label"},"电流",-1)),e("div",At,m(t.value.current)+"A",1)]),e("div",It,[a[10]||(a[10]=e("div",{class:"info-label"},"功率",-1)),e("div",zt,m(t.value.power)+"W",1)])]),e("div",Wt,[a[16]||(a[16]=e("div",{class:"info-title"},"运行状态",-1)),e("div",Ot,[a[12]||(a[12]=e("div",{class:"info-label"},"CPU 负载",-1)),e("div",Ht,m(t.value.cpuLoad)+"%",1)]),e("div",Rt,[a[13]||(a[13]=e("div",{class:"info-label"},"内存使用",-1)),e("div",Nt,m(t.value.memoryUsage)+"%",1)]),e("div",Ft,[a[14]||(a[14]=e("div",{class:"info-label"},"磁盘使用",-1)),e("div",Bt,m(t.value.diskUsage)+"%",1)]),e("div",jt,[a[15]||(a[15]=e("div",{class:"info-label"},"网络流量",-1)),e("div",Ut,m(t.value.networkTraffic)+" Mbps",1)])]),e("div",Vt,[a[17]||(a[17]=e("div",{class:"info-title"},"告警信息",-1)),e("div",Gt,[(y(!0),M(N,null,F(t.value.alarms,L=>(y(),M("div",{class:"alarm-item",key:L.id},[e("div",{class:"alarm-icon",style:z({background:c(L.type)})},m(n(L.type)),5),e("div",qt,[e("div",Kt,m(L.name),1),e("div",Yt,m(L.time),1)])]))),128))])])])]))}}),Qt=C(Jt,[["__scopeId","data-v-f59be46d"]]),se=de(),Xt={class:"label-wrapper"},Zt=x({__name:"WidgetLabel",props:{name:{},position:{}},setup(p){const o=p,i=()=>{se.emit("showDeviceDetail",t())},d=["1# 服务器机柜","2# 服务器机柜","3# 服务器机柜","1# 网络设备","6# 网络设备","1# 电源柜","2# 电源柜","3# 电源柜","4# 电源柜","5# 电源柜","6# 电源柜"],t=()=>{const s={name:o.name,type:"未知设备",status:"normal",serialNumber:`1000${Math.floor(Math.random()*9e3)}`,location:"数据中心 A 区",temperature:Math.floor(Math.random()*30)+20,humidity:Math.floor(Math.random()*40)+40,voltage:Math.floor(Math.random()*20)+220,current:Math.floor(Math.random()*10)+5,power:Math.floor(Math.random()*2e3)+1e3,cpuLoad:Math.floor(Math.random()*60)+20,memoryUsage:Math.floor(Math.random()*50)+30,diskUsage:Math.floor(Math.random()*40)+40,networkTraffic:Math.floor(Math.random()*1e3)+500,alarms:[]};return o.name.includes("服务器机柜")?(s.type="服务器机柜",s.status=d.includes(o.name)?"error":"normal",s.alarms=[{id:1,name:"温度过高",type:"warning",time:"10:23"},{id:2,name:"内存过载",type:"error",time:"09:15"}]):o.name.includes("网络设备")?(s.type="网络设备",s.status=d.includes(o.name)?"warning":"normal",s.alarms=[{id:1,name:"网络延迟过高",type:"warning",time:"11:05"}]):o.name.includes("电源柜")?(s.type="电源柜",s.status=d.includes(o.name)?"error":"normal",s.alarms=[{id:1,name:"电压波动",type:"warning",time:"09:44"},{id:2,name:"电流过高",type:"error",time:"12:53"}]):(s.type="其他设备",s.status="normal",s.alarms=[]),s};return(s,r)=>(y(),M("div",Xt,[e("div",{class:"label",onClick:A(i,["stop"])},m(p.name),1)]))}}),es=C(Zt,[["__scopeId","data-v-cf1d166e"]]);function ts(p){const o=p||$(null),i=P(null),d=P(null),t=P(null),s=P(null),r=P(null),c=new Map,n=[],u=new be,f=new Map,a=()=>{const l=u.getDelta();if(t.value&&i.value&&d.value){t.value.render(i.value,d.value);const v=u.getDelta();n.forEach(g=>g.update(v)),c.forEach(g=>g.render(l)),f.forEach(g=>Z.isFunction(g)&&g(l)),s.value&&s.value.render(i.value,d.value),we.update()}requestAnimationFrame(a)},L=()=>{if(!o.value)return;const{clientWidth:l,clientHeight:v}=o.value;if(i.value=new me,d.value=new Y(45,l/v,1,1e4),d.value.position.set(20,15,20),t.value=new fe({antialias:!0,alpha:!0}),t.value.shadowMap.enabled=!1,t.value.setSize(l,v),t.value.setClearAlpha(.5),o.value.appendChild(t.value.domElement),s.value=new pe,s.value.setSize(l,v),s.value.domElement.className="css2d-renderer",s.value.domElement.style.position="absolute",s.value.domElement.style.top="0px",s.value.domElement.style.pointerEvents="none",s.value.domElement.style.zIndex="100",o.value.appendChild(s.value.domElement),d.value&&t.value&&(r.value=new ge(d.value,t.value.domElement),r.value.minPolarAngle=0,r.value.enableDamping=!0,r.value.dampingFactor=.1,r.value.target.set(0,5,0),r.value.maxPolarAngle=Math.PI/2,r.value.minDistance=10,r.value.maxDistance=100,r.value.update()),i.value){const g=new _e(10066329,10);i.value.add(g);const w=new he(16777215,.5);w.position.set(20,20,20),w.position.multiplyScalar(1),w.castShadow=!0,w.shadow.mapSize=new ye(1024,1024),i.value.add(w)}},k=new ue;k.setDecoderPath("/js/draco/gltf/"),k.setDecoderConfig({type:"js"});const H=l=>{const v=new ve;v.setDRACOLoader(k);const g=(D,I)=>I(D),w=(D,I)=>{console.error("模型加载失败:",l,D),I(D)};return new Promise((D,I)=>{v.load(l,B=>g(B,D),void 0,B=>w(B,I))})},R=new Promise((l,v)=>{S(()=>{const g=()=>{console.log("boostrap 调用时 container.value:",o.value);try{if(!o.value||o.value.clientHeight===0){console.log("容器尺寸为0，等待DOM更新"),setTimeout(g,100);return}L(),i.value&&d.value&&t.value?(console.log("Three.js 场景初始化成功"),window.addEventListener("resize",b),a(),l()):(console.error("Three.js 场景初始化失败：缺少必要组件",{scene:!!i.value,camera:!!d.value,renderer:!!t.value,container:!!o.value}),v(new Error("Three.js 场景初始化失败")))}catch(w){console.error("Three.js 场景初始化过程中发生错误：",w),v(w)}};o.value?(console.log("容器已经准备好，立即初始化"),g()):(console.log("容器尚未准备好，等待 500ms 后重试"),setTimeout(g,500))}),W(()=>{window.removeEventListener("resize",b)})}),b=()=>{if(!o.value||!d.value||!t.value||!s.value)return;const{clientWidth:l,clientHeight:v}=o.value;d.value instanceof Y&&(d.value.aspect=l/v,d.value.updateProjectionMatrix()),t.value.setSize(l,v),s.value.setSize(l,v)};return{container:o,scene:i,camera:d,renderer:t,cssRenderer:s,controls:r,mixers:n,renderMixins:f,composers:c,loadGltf:H,enableControls:()=>{r.value&&(r.value.enabled=!0)},disableControls:()=>{r.value&&(r.value.enabled=!1)},boostrapPromise:R}}const T={BuildingModel:"/models/base.glb",DeviceModel:"/models/devices.glb",LineModel:"/models/lines.gltf"},j=[{name:"1# 服务器机柜",position:[-32,8,-22]},{name:"2# 服务器机柜",position:[-20.2,8,-22]},{name:"3# 服务器机柜",position:[-8.4,8,-22]},{name:"4# 服务器机柜",position:[3.4,8,-22]},{name:"5# 服务器机柜",position:[15.2,8,-22]},{name:"6# 服务器机柜",position:[27,8,-22]},{name:"1# 网络设备",position:[-32,8,-6]},{name:"2# 网络设备",position:[-20.2,8,-6]},{name:"3# 网络设备",position:[-8.4,8,-6]},{name:"4# 网络设备",position:[3.4,8,-6]},{name:"5# 网络设备",position:[15.2,8,-6]},{name:"6# 网络设备",position:[27,8,-6]},{name:"1# 电源柜",position:[-33,6,14]},{name:"2# 电源柜",position:[-21.2,6,14]},{name:"3# 电源柜",position:[-9.4,6,14]},{name:"4# 电源柜",position:[2.4,6,14]},{name:"5# 电源柜",position:[14.2,6,14]},{name:"6# 电源柜",position:[26,6,14]}];function ss(p){const{container:o,scene:i,loadGltf:d,enableControls:t,disableControls:s,boostrapPromise:r}=ts(p),c={building:null,devices:null,lines:null},n=X({total:3,loaded:0,isLoading:!0}),u=P([]),f=$(null),a=async()=>{const b=async()=>{try{console.log("开始加载建筑模型:",T.BuildingModel);const l=await d(T.BuildingModel);n.loaded+=1,c.building=l.scene,i.value.add(l.scene),console.log("建筑模型加载成功")}catch(l){console.error("建筑模型加载失败:",l),n.loaded+=1}},_=async()=>{try{console.log("开始加载设备模型:",T.DeviceModel);const l=await d(T.DeviceModel);console.log("设备模型结构:",l.scene),console.log("设备模型子对象:",l.scene.children),l.scene.children.forEach((v,g)=>{console.log(`子对象 ${g}:`,v.name),v.children&&v.children.forEach((w,D)=>{console.log(`  孙对象 ${D}:`,w.name)})}),l.scene.children.forEach((v,g)=>{v.name.includes("设备")&&v.children&&(console.log(`加载设备组 ${g}: ${v.name}，包含 ${v.children.length} 个设备`),u.value.push(...v.children))}),console.log("加载的设备总数:",u.value.length),n.loaded+=1,c.devices=l.scene,i.value.add(l.scene),console.log("设备模型加载成功"),console.log("加载的设备数量:",u.value.length)}catch(l){console.error("设备模型加载失败:",l),n.loaded+=1}},h=async()=>{try{console.log("开始加载线路模型:",T.LineModel);const l=await d(T.LineModel);n.loaded+=1,c.lines=l.scene,i.value.add(l.scene),console.log("线路模型加载成功")}catch(l){console.error("线路模型加载失败:",l),n.loaded+=1}};await Promise.all([b(),_(),h()]),L(),console.log("设备数组长度:",u.value.length),console.log("设备数组内容:",u.value),H(),n.isLoading=!1,n.loaded=3},L=()=>{if(!c.building)return;const b=[];c.building.traverse(_=>{"name"in _&&_.name.includes("道路箭头")&&b.push(_)}),b.forEach(_=>{_.parent&&_.parent.remove(_)}),console.log(`已移除 ${b.length} 个道路箭头`)},k=()=>{if(console.log("addDeviceLabels 函数被调用"),!i.value){console.warn("场景未初始化，无法添加设备标签");return}const b=(_,h)=>{const l=x({render(){return Le(_,h)}}),v=E(l);return $e(v,document.createElement("div")),v.el};console.log("LabelPositions 数组长度:",j.length),j.forEach((_,h)=>{console.log(`正在添加第 ${h+1} 个设备标签:`,_);const l=b(es,_);if(l){console.log("成功创建 DOM 元素:",l.outerHTML);const v=new Me(l);v.position.set(_.position[0],_.position[1],_.position[2]),i.value.add(v),console.log("成功添加到场景")}else console.warn("无法创建 DOM 元素")})},H=()=>{f.value&&(window.clearInterval(f.value),f.value=null);const b=["1# 服务器机柜","2# 服务器机柜","3# 服务器机柜","1# 网络设备","6# 网络设备","1# 电源柜","2# 电源柜","3# 电源柜","4# 电源柜","5# 电源柜","6# 电源柜"];console.log("设备数组内容:",u.value),console.log("设备数组长度:",u.value.length);const _=b.map(h=>{const l=j.findIndex(v=>v.name===h);return console.log(`设备 "${h}" 在 LabelPositions 中的索引:`,l),l}).filter(h=>h!==-1);console.log("告警设备索引:",_),_.forEach(h=>{const l=u.value[h];l?(console.log(`找到告警设备 ${h}:`,l),l.traverse(v=>{if(!(v instanceof J))return;const g=v;Array.isArray(g.material)?g.material=g.material.map(D=>D.clone()):g.material=g.material.clone();const w=Array.isArray(g.material)?g.material[0]:g.material;if(w&&"emissive"in w){const D=w;g.currentHex=g.currentHex??D.emissive.getHex(),D.emissive.setHex(16711680)}})):console.warn(`未找到索引为 ${h} 的设备`)})},R=()=>{f.value&&(window.clearInterval(f.value),f.value=null),u.value.forEach(b=>{b&&b.traverse(_=>{if(!(_ instanceof J))return;const h=_;Array.isArray(h.material)?h.material.forEach(l=>{l&&"emissive"in l&&l.emissive.setHex(h.currentHex)}):h.material&&"emissive"in h.material&&h.material.emissive.setHex(h.currentHex)})})};return S(()=>{console.log("useDataCenter onMounted 钩子被调用"),ee(async()=>{try{console.log("开始等待 boostrapPromise 解析"),await r,console.log("boostrapPromise 已解析"),i.value?(console.log("场景已初始化，开始加载模型"),await a(),k()):console.error("场景初始化失败，无法继续加载模型")}catch(b){console.error("初始化过程中发生错误：",b)}})}),W(()=>{R()}),{container:o,loadModel:a,loading:n,startWarming:H,stopWarming:R,enableControls:t,disableControls:s}}const as={class:"layout"},os={class:"layout-main"},ns={class:"main-left"},ls={key:0,class:"mask"},is=x({__name:"App",setup(p){const o=$(null),{loading:i,startWarming:d,stopWarming:t,enableControls:s,disableControls:r}=ss(o);De(()=>{});const c=$(!1),n=$(null);return S(()=>{se.on("showDeviceDetail",u=>{n.value=u})}),Q("mask",{show:()=>{c.value=!0},hide:()=>{c.value=!1}}),Q("events",{startWarming:d,stopWarming:t,enableControls:s,disableControls:r}),(u,f)=>(y(),M("div",as,[E(Te),E(Be),E(Ge,{loading:xe(i)},null,8,["loading"]),e("div",os,[e("div",ns,[E(it),E(et),E(mt)]),e("div",{class:"main-right",ref_key:"threeContainer",ref:o},null,512),c.value?(y(),M("div",ls)):V("",!0)]),n.value?(y(),O(Qt,{key:0,"device-data":n.value,onClose:f[0]||(f[0]=a=>n.value=null),onClick:f[1]||(f[1]=A(()=>{},["stop"]))},null,8,["device-data"])):V("",!0)]))}}),rs=C(is,[["__scopeId","data-v-353d871a"]]),cs=async()=>{Ce(rs).mount("#app");const o=[1920,1080];Se.init({el:"#app",dw:o[0],dh:o[1],resize:!0})};cs();
